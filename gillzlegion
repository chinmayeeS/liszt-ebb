#!terra/terra

-- unfortunately, this script will only work when invoked from the
-- directory in which it's located.  =(  The tricky part is that
-- Terra would have to be installed in a more globally visible way
-- to avoid this...

-- If we can run from elsewhere, then make sure to modify the Lua/Terra paths


-- Here, make sure that the legion library is loaded.
local legion_dir    = './legion'
local bindings_dir  = legion_dir..'/bindings/terra'
local runtime_dir   = legion_dir..'/runtime'

-- Link in a particular library
terralib.linklibrary(bindings_dir..'/liblegion_terra.so') -- change to dylib?
-- Extend the Terra path that looks for C header files
terralib.includepath = terralib.includepath..';'..runtime_dir..
                                             ';'..bindings_dir
-- Extend the Lua path
package.path = package.path .. ';'..bindings_dir..'/?.t'

if #arg > 0 then
  terralib.loadfile('./compiler/launch_script.t')()
else
  os.execute('terra/terra')
end
